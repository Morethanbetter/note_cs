# 一致性

要解决数据不丢失的问题，只能通过数据冗余的方法，就算是数据分区，每个区也需要进行数据冗余处理。这就是数据副本。当出现某个节点的数据丢失时，可以从副本读到。数据副本是分布式系统解决数据丢失异常的唯一手段。简单来说：

1. 要想让数据有高可用性，就得写多份数据。
2. 写多份会引起数据一致性的问题。
3. 数据一致性的问题又会引发性能问题。



在解决数据副本间的一致性问题时，我们有一些技术方案。

- Master-Slave 方案。
- Master-Master 方案。
- 两阶段和三阶段提交方案。
- Paxos 方案。



《[分布式系统的事务处理](https://coolshell.cn/articles/10910.html)》。其中引用了 Google App Engine 联合创始人赖安·巴里特（Ryan Barrett）在 2009 年 Google I/O 上的演讲[Transaction Across DataCenter 视频](https://www.youtube.com/watch?v=srOgpXECblk) 中的一张图。

![img](一致性.assets/e566933d9967f2f5e0f4dcddc66247ec.png)

从上面这张经典的图中，我们可以看到各种不同方案的对比。

现在，很多公司的分布式系统事务基本上都是两阶段提交的变种。比如：阿里推出的 TCC–Try–Confirm–Cancel，或是我在亚马逊见到的 Plan–Reserve–Confirm 的方式，等等。凡是通过**业务补偿**，或是在业务**应用层**上做的分布式事务的玩法，基本上都是两阶段提交，或是两阶段提交的变种。

换句话说，迄今为止，在==应用层==上解决事务问题，只有“==两阶段提交==”这样的方式，而在==数据层==上解决事务问题，==Paxos、Raft 或是 NWR 算法==则是不二之选。

